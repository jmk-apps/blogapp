{% include "header.html" %}

    <div class="container">

      <div class="row">
        <div class="col-md-9">

            {% include "flash_message.html" %}

          <article class="card mb-4">
            <header class="card-header text-center">
              <div class="card-meta">
                  <small class="fs-6">{{ post.date_posted.strftime("%d-%b-%Y") }} in <a href="page-category.html">{{ post.category }}</a></small>
              </div>
                <a href="#">{{ post.author.username }}</a>
                <h1 class="card-title">{{ post.title }}</h1>
            </header>
              <img class="card-img" src="{{ url_for('static', filename='post_pics/' + post.post_pic) }}" alt="" />
            <div class="card-body">

              <h4 class="fw-bold">{{ post.subtitle }}</h4>
              <p>{{ post.content | safe }}</p>
                <div class="row">
                    <div class="d-flex mt-1 justify-content-end">
                        <a class="btn btn-sm btn-primary" href="{{ url_for('update_post', post_id=post.id) }}">Update</a>
                        <button
                                class="btn btn-sm btn-danger ms-2"
                                data-bs-toggle="modal"
                                data-bs-target="#deleteModal">
                            Delete
                        </button>
                    </div>
                </div>

              <hr />

              <div class="mt-4">
                <h3 class="mb-3">Write a comment</h3>
                  <form action="{{ url_for('show_post', post_id=post.id) }}" method="post" novalidate>
                    {{ form.csrf_token }}
                      <div>
                          {% if form.content.errors %}
                              {{ form.content(class_="form-control is-invalid", rows="6", placeholder="Comment here...") }}
                              <div class="invalid-feedback">
                                {% for error in form.content.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                              </div>
                          {% else %}
                              {{ form.content(class_="form-control", rows="6", placeholder="Comment here...") }}
                          {% endif %}
                      </div>
                      <div>
                          {{ form.submit(class_="btn btn-success mt-3") }}
                      </div>
                  </form>
              </div>


              <h4 class="mt-4">{{ num_comments }} comments</h4>

              {% for comment in post.comments %}
                <div class="d-flex mb-3 p-3 bg-light">
                    <div class="text-center">
                      <img class="me-3 rounded-circle" src="{{ url_for('static', filename='profile_pics/' + comment.comment_author.profile_pic) }}" alt="profile picture" width="100" height="100">
                      <h6 class="mt-1 mb-0 me-3">{{ comment.comment_author.username  }}</h6>
                    </div>
                    <div class="flex-grow-1">
                      <p class="mt-3 mb-2">{{ comment.content }}</p>
                      <small class="text-muted">{{ comment.date_posted.strftime("%d-%b-%Y") }}</small>
                      <a class="float-end" href="#"><span class="fa fa-reply"></span> Reply</a>
                    </div>
                </div>
              {% endfor %}

            </div>
          </article><!-- /.card -->

        </div>

          {% include "sidebar.html" %}

      </div>
    </div>

<!-- Modal for the delete button -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="deleteModalLabel">Delete Post?</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <form action="{{ url_for('delete_post', post_id=post.id) }}" method="post">
              <input class="btn btn-danger" type="submit" value="Delete">
          </form>
      </div>
    </div>
  </div>
</div>
<!-- Modal for the delete button -->

{% include "footer.html" %}
